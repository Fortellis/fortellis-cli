const fs = require('fs');
const path = require('path');
const process = require('process');
const childProcess = require('child_process');

const pkg = JSON.parse(
  fs.readFileSync(path.resolve(__dirname, 'package.json'), 'utf8')
);
const { version, name } = pkg;

childProcess.exec(`npm view ${name} version`, (err, stdout) => {
  console.log(`Checking if version ${version} exists for package ${name}.`);
  if (err) {
    console.log(err);
    process.exit(1);
  }
  const currentVersion = stdout.trim();
  if (currentVersion === version) {
    console.log(
      `Version ${version} already exists for package ${name}. Please update version!`
    );
    process.exit(1);
  }
  console.log(
    `Version ${version} does not already exist for package ${name}. Current latest version is ${currentVersion}.`
  );
  process.exit(0);
});
