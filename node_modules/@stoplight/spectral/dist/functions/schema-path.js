"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const schema_1 = require("./schema");
const { JSONPath } = require('jsonpath-plus');
exports.schemaPath = (targetVal, opts, paths, otherValues) => {
    if (!targetVal || typeof targetVal !== 'object')
        return [];
    const { original: object } = otherValues;
    const relevantObject = opts.field ? object[opts.field] : object;
    if (!relevantObject)
        return [];
    const { target, given } = paths;
    const lastItem = target
        ? target.length > 0 && target[target.length - 1]
        : given.length > 0 && given[given.length - 1];
    let schemaObject;
    try {
        schemaObject = JSONPath({ path: opts.schemaPath, json: object })[0];
    }
    catch (error) {
        console.error(error);
    }
    if (opts.field) {
        given.push(opts.field);
        if (target) {
            target.push(opts.field);
        }
    }
    const errors = schema_1.schema(relevantObject, { schema: schemaObject }, paths, otherValues);
    return (errors &&
        errors.map(error => {
            const propertyPath = [lastItem, opts.field].filter(Boolean).join('.');
            return Object.assign(Object.assign({}, error), { message: `${propertyPath ? `"${propertyPath}"` : ''} property ${error.message}` });
        }));
};
//# sourceMappingURL=schema-path.js.map